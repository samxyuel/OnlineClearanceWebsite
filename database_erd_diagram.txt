ONLINE CLEARANCE SYSTEM - ENTITY RELATIONSHIP DIAGRAM
========================================================

ACADEMIC STRUCTURE
------------------
academic_years (1) ──────────────── (many) semesters
     │                                      │
     │                                      │
     └── (many) clearance_periods ──────────┘

USER MANAGEMENT
---------------
users (1) ──→ (1) students
users (1) ──→ (1) faculty
users (1) ──→ (1) staff
users (many) ──→ (many) roles [via user_roles]
roles (many) ──→ (many) permissions [via role_permissions]

ORGANIZATIONAL STRUCTURE
------------------------
sectors (1) ──→ (many) departments
departments (1) ──→ (many) programs
departments (1) ──→ (many) staff [Program Heads only]
staff (many) ──→ (many) departments [via staff_department_assignments]

CLEARANCE SYSTEM
----------------
clearance_periods (1) ──→ (many) clearance_forms
clearance_forms (1) ──→ (many) clearance_signatories
sector_signatory_assignments ──→ clearance_periods [via sector matching]

DETAILED ENTITY STRUCTURE
=========================

ACADEMIC_YEARS
├── academic_year_id (PK)
├── year (UNIQUE)
├── is_active
└── timestamps

SEMESTERS  
├── semester_id (PK)
├── semester_name (1st/2nd/Summer)
├── academic_year_id (FK)
├── is_active
└── timestamps

SECTORS
├── sector_id (PK)
├── sector_name (College/SHS/Faculty)
└── timestamps

DEPARTMENTS
├── department_id (PK)
├── department_name
├── department_code (UNIQUE)
├── department_type
├── sector_id (FK)
└── timestamps

USERS
├── user_id (PK)
├── username (UNIQUE)
├── password
├── email (UNIQUE)
├── first_name, last_name, middle_name
├── contact_number
├── status
└── timestamps

STUDENTS
├── student_id (PK)
├── user_id (FK, UNIQUE)
├── program_id (FK)
├── department_id (FK)
├── sector (College/SHS)
├── section, year_level
├── enrollment_status
└── timestamps

FACULTY
├── employee_number (PK)
├── user_id (FK, UNIQUE)
├── employment_status
├── department_id (FK)
├── sector (Faculty)
└── timestamps

STAFF
├── employee_number (PK)
├── user_id (FK, UNIQUE)
├── designation_id (FK)
├── staff_category
├── department_id (FK)
└── timestamps

DESIGNATIONS
├── designation_id (PK)
├── designation_name
├── description
└── is_active

CLEARANCE_PERIODS
├── period_id (PK)
├── academic_year_id (FK)
├── semester_id (FK)
├── sector (College/SHS/Faculty)
├── period_name
├── start_date, end_date
├── status (Not Started/Ongoing/Paused/Closed)
└── timestamps

CLEARANCE_FORMS
├── clearance_form_id (PK)
├── user_id (FK)
├── academic_year_id (FK)
├── semester_id (FK)
├── clearance_type (College/SHS/Faculty)
├── status (Unapplied/Pending/Processing/Approved/Rejected)
├── applied_at, completed_at, rejected_at
└── timestamps

CLEARANCE_SIGNATORIES
├── signatory_id (PK)
├── clearance_form_id (FK)
├── designation_id (FK)
├── actual_user_id (FK)
├── action (Pending/Approved/Rejected)
├── remarks
├── date_signed
└── timestamps

SECTOR_SIGNATORY_ASSIGNMENTS
├── assignment_id (PK)
├── clearance_type (College/SHS/Faculty)
├── user_id (FK)
├── designation_id (FK)
├── is_program_head
├── department_id (FK)
├── is_required_first
├── is_required_last
└── timestamps

SECTOR_CLEARANCE_SETTINGS
├── setting_id (PK)
├── clearance_type (College/SHS/Faculty)
├── include_program_head
├── required_first_enabled
├── required_first_designation_id (FK)
├── required_last_enabled
├── required_last_designation_id (FK)
└── timestamps

KEY RELATIONSHIPS
=================

1. ACADEMIC FLOW:
   academic_years → semesters → clearance_periods

2. USER HIERARCHY:
   users → students/faculty/staff
   users → roles → permissions

3. ORGANIZATIONAL:
   sectors → departments → programs
   departments → staff (Program Heads)

4. CLEARANCE WORKFLOW:
   clearance_periods → clearance_forms → clearance_signatories
   sector_signatory_assignments → clearance_periods (via sector)

5. SIGNATORY ASSIGNMENT:
   sector_signatory_assignments defines which signatories are assigned to each sector
   clearance_signatories are created per form based on sector assignments

STORED PROCEDURES
=================
- StartClearancePeriod: Creates period and forms for sector
- CloseClearancePeriod: Closes period and updates forms

VIEWS
=====
- active_clearance_periods: Active periods with academic info
- clearance_forms_with_sector: Forms with sector information

TRIGGERS
========
- generate_clearance_form_id: Auto-generate form IDs
- ensure_single_active_academic_year: Only one active year
- staff_bi/bu: Validate employee number format
- enforce_single_active_clearance_period: Only one active period

DATA FLOW
=========
1. Setup: Create academic years, semesters, assign signatories
2. Activation: Activate terms, create clearance periods
3. Clearance: Start sector clearance, create forms
4. Signatory: Review and approve/reject forms
5. Completion: Close periods, finalize forms
